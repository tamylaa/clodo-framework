name: Validate X Bearer Token (dry run)
# registration-nudge: 2026-02-02T12:00:00Z ‚Äî non-functional comment to force workflow re-registration
on:
  workflow_dispatch:

jobs:
  validate-token:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Check OAuth1.0a secrets presence
        run: |
          if [ -z "${{ secrets.X_API_KEY }}" ] || [ -z "${{ secrets.X_API_SECRET }}" ] || [ -z "${{ secrets.X_ACCESS_TOKEN }}" ] || [ -z "${{ secrets.X_ACCESS_SECRET }}" ]; then
            echo "‚ùå Required OAuth1.0a secrets (X_API_KEY/SECRET, X_ACCESS_TOKEN/SECRET) are not set"
            exit 1
          fi
          echo "üîí All required OAuth1.0a secrets are present"

      - name: Dry-check GET /2/users/me (OAuth1)
        env:
          X_API_KEY: ${{ secrets.X_API_KEY }}
          X_API_SECRET: ${{ secrets.X_API_SECRET }}
          X_ACCESS_TOKEN: ${{ secrets.X_ACCESS_TOKEN }}
          X_ACCESS_SECRET: ${{ secrets.X_ACCESS_SECRET }}
        run: |
          set -euo pipefail
          node scripts/x-oauth1.js --dry-check
